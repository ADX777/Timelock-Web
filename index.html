<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üîê Quantum-Resistant Crypto Vault</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; img-src 'self' https: data:; style-src 'self' https: 'unsafe-inline'; script-src 'self' https:; connect-src 'self' https:;"> 
  <link rel="stylesheet" href="style.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Crypto Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="https://unpkg.com/@noble/curves@1.1.0/lib/esm/ed25519.js"></script>
  <script src="https://unpkg.com/@noble/hashes@1.3.0/lib/esm/sha256.js"></script>
  <script src="https://unpkg.com/kyber@0.0.1/dist/kyber.min.js"></script>
  <script src="https://unpkg.com/dilithium@0.0.1/dist/dilithium.min.js"></script>
  
  <!-- Web3 Libraries -->
  <script src="https://unpkg.com/web3@1.9.0/dist/web3.min.js"></script>
  <script src="https://unpkg.com/@near-wallet-selector/core@7.1.0/lib/index.umd.js"></script>
  
  <!-- Pyth Network -->
  <script src="https://hermes.pyth.network/api/latest/price_feeds.js"></script>
  
  <!-- Drand Network -->
  <script src="https://drand.cloudflare.com/api/public/latest"></script>
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="app-header">
      <div class="header-content">
        <div class="logo-section">
          <i class="fas fa-shield-alt logo-icon"></i>
          <h1 class="app-title">Quantum Vault</h1>
          <span class="app-subtitle">Fintech-Grade Encryption</span>
        </div>
        <div class="header-actions">
          <button class="theme-toggle" onclick="toggleTheme()">
            <i class="fas fa-moon"></i>
          </button>
          <button class="connect-wallet-btn" onclick="connectWallet()">
            <i class="fas fa-wallet"></i>
            <span id="wallet-status">Connect Wallet</span>
          </button>
        </div>
      </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="tab-navigation">
      <div class="tab-container">
        <button class="tab-button active" data-tab="encrypt">
          <i class="fas fa-lock"></i>
          <span>M√£ h√≥a</span>
        </button>
        <button class="tab-button" data-tab="inheritance">
          <i class="fas fa-users"></i>
          <span>Th·ª´a k·∫ø</span>
        </button>
        <button class="tab-button" data-tab="decrypt">
          <i class="fas fa-unlock"></i>
          <span>Gi·∫£i m√£</span>
        </button>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Encryption Tab -->
      <section id="encrypt-tab" class="tab-content active">
        <div class="content-card">
          <div class="card-header">
            <h2><i class="fas fa-lock"></i> M√£ h√≥a d·ªØ li·ªáu</h2>
            <p class="card-subtitle">B·∫£o v·ªá th√¥ng tin v·ªõi m√£ h√≥a ch·ªëng l∆∞·ª£ng t·ª≠</p>
          </div>

          <!-- Input Method Selection -->
          <div class="input-method-section">
            <div class="method-toggle">
              <label class="toggle-option">
                <input type="radio" name="inputMethod" value="note" checked>
                <span class="toggle-label">
                  <i class="fas fa-key"></i>
                  Ghi ch√∫ b√≠ m·∫≠t
                </span>
              </label>
              <label class="toggle-option">
                <input type="radio" name="inputMethod" value="positions">
                <span class="toggle-label">
                  <i class="fas fa-dice"></i>
                  12 v·ªã tr√≠ t·ª´ kh√≥a b√≠ m·∫≠t
                </span>
              </label>
            </div>
          </div>

          <!-- Secret Note Input -->
          <div id="note-input" class="input-section">
            <label class="input-label">
              <i class="fas fa-key"></i>
              Ghi ch√∫ b√≠ m·∫≠t (kh√¥ng d·∫•u)
            </label>
            <textarea 
              id="secret-note-textarea" 
              placeholder="Nh·∫≠p ghi ch√∫ b√≠ m·∫≠t kh√¥ng d·∫•u, k√Ω t·ª± ASCII, kh√¥ng d√πng d·∫•u ti·∫øng Vi·ªát..."
              class="input-field"
              rows="3"
            ></textarea>
          </div>

          <!-- 12 Keyword Positions Input -->
          <div id="positions-input" class="input-section" style="display: none;">
            <label class="input-label">
              <i class="fas fa-dice"></i>
              12 v·ªã tr√≠ t·ª´ kh√≥a b√≠ m·∫≠t (m·ªói s·ªë t·ª´ 1 ƒë·∫øn 12)
            </label>
            <div class="positions-grid" id="positions-grid">
              <select class="input-field position-select" data-index="1"><option value="" selected disabled>Ch·ªçn</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option></select>
              <select class="input-field position-select" data-index="2"><option value="" selected disabled>Ch·ªçn</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option></select>
              <select class="input-field position-select" data-index="3"><option value="" selected disabled>Ch·ªçn</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option></select>
              <select class="input-field position-select" data-index="4"><option value="" selected disabled>Ch·ªçn</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option></select>
              <select class="input-field position-select" data-index="5"><option value="" selected disabled>Ch·ªçn</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option></select>
              <select class="input-field position-select" data-index="6"><option value="" selected disabled>Ch·ªçn</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option></select>
              <select class="input-field position-select" data-index="7"><option value="" selected disabled>Ch·ªçn</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option></select>
              <select class="input-field position-select" data-index="8"><option value="" selected disabled>Ch·ªçn</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option></select>
              <select class="input-field position-select" data-index="9"><option value="" selected disabled>Ch·ªçn</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option></select>
              <select class="input-field position-select" data-index="10"><option value="" selected disabled>Ch·ªçn</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option></select>
              <select class="input-field position-select" data-index="11"><option value="" selected disabled>Ch·ªçn</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option></select>
              <select class="input-field position-select" data-index="12"><option value="" selected disabled>Ch·ªçn</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option>11</option><option>12</option></select>
            </div>
            <div class="condition-info">
              <i class="fas fa-info-circle"></i>
              <span>Ch·ªâ ch·ªçn s·ªë t·ª´ 1 ƒë·∫øn 12 cho t·ª´ng v·ªã tr√≠</span>
            </div>
          </div>

          <!-- Security Note -->
          <div class="input-section">
            <label class="input-label">
              <i class="fas fa-sticky-note"></i>
              Ghi ch√∫ b·∫£o m·∫≠t (t√πy ch·ªçn)
            </label>
            <textarea 
              id="security-note" 
              placeholder="Ghi ch√∫ s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã khi unlock..."
              class="input-field"
              rows="2"
            ></textarea>
          </div>

          <!-- Unlock Conditions -->
          <div class="unlock-conditions">
            <h3 class="section-title">
              <i class="fas fa-clock"></i>
              ƒêi·ªÅu ki·ªán m·ªü kh√≥a
            </h3>
            
            <!-- Time Condition -->
            <div class="condition-group">
              <label class="condition-label">
                <i class="fas fa-calendar-alt"></i>
                Th·ªùi gian (b·∫Øt bu·ªôc)
              </label>
              <input 
                type="datetime-local" 
                id="unlock-time" 
                class="input-field"
                required
              >
              <div class="condition-info">
                <i class="fas fa-info-circle"></i>
                S·ª≠ d·ª•ng ngu·ªìn th·ªùi gian phi t·∫≠p trung (drand)
              </div>
            </div>

            <!-- Price Conditions -->
            <div class="condition-group">
              <label class="condition-label">
                <i class="fas fa-chart-line"></i>
                ƒêi·ªÅu ki·ªán gi√° (t√πy ch·ªçn)
              </label>
              <div class="input-section" style="margin-top: var(--spacing-3);">
                <label class="input-label">
                  <i class="fas fa-coins"></i>
                  C·∫∑p t√†i s·∫£n (Binance/Forex)
                </label>
                <div class="asset-input-wrapper">
                  <input 
                    type="text" 
                    id="crypto-pair-input" 
                    placeholder="V√≠ d·ª•: BTCUSDT, ETHUSDT, XAUUSD..."
                    class="input-field"
                    autocomplete="off"
                  >
                  <div id="crypto-suggestions" class="suggestions-dropdown" style="display:none;"></div>
                </div>
              </div>
              <div class="price-inputs">
                <div class="price-input-group">
                  <label>Cao h∆°n</label>
                  <input 
                    type="number" 
                    id="price-higher" 
                    placeholder="Gi√° cao h∆°n"
                    class="input-field"
                    step="0.000001"
                  >
                </div>
                <div class="price-input-group">
                  <label>Th·∫•p h∆°n</label>
                  <input 
                    type="number" 
                    id="price-lower" 
                    placeholder="Gi√° th·∫•p h∆°n"
                    class="input-field"
                    step="0.000001"
                  >
                </div>
              </div>
              <div id="price-hint" class="price-hint" style="display:none;"></div>
              <div class="condition-info">
                <i class="fas fa-info-circle"></i>
                S·ª≠ d·ª•ng Pyth TWAP + confidence
              </div>
            </div>
          </div>

          <!-- Encrypt Button -->
          <button class="primary-btn encrypt-btn" onclick="encryptData()">
            <i class="fas fa-lock"></i>
            M√£ h√≥a d·ªØ li·ªáu
          </button>

          <!-- Encrypted Result -->
          <div id="encrypted-result" class="result-section" style="display: none;">
            <div class="result-header">
              <h3><i class="fas fa-check-circle"></i> M√£ h√≥a th√†nh c√¥ng</h3>
              <button class="copy-btn" onclick="copyEncryptedResult()">
                <i class="fas fa-copy"></i>
                Copy
              </button>
            </div>
            <div class="encrypted-content">
              <textarea 
                id="encrypted-output" 
                class="frozen-textarea" 
                readonly
                rows="6"
              ></textarea>
            </div>
            <div class="blockchain-info">
              <i class="fas fa-link"></i>
              <span>ƒê√£ ghi th√¥ng tin l√™n Near Protocol</span>
              <a id="explorer-link" href="#" target="_blank" class="hash-link">
                <span id="transaction-hash"></span>
              </a>
            </div>
          </div>
        </div>
      </section>

      <!-- Inheritance Tab -->
      <section id="inheritance-tab" class="tab-content">
        <div class="content-card">
          <div class="card-header">
            <h2><i class="fas fa-users"></i> Thi·∫øt l·∫≠p th·ª´a k·∫ø</h2>
            <p class="card-subtitle">Chia s·∫ª th√¥ng tin an to√†n v·ªõi ng∆∞·ªùi th√¢n</p>
          </div>

          <!-- Part 1: Encrypted Data Input -->
          <div class="input-section">
            <label class="input-label">
              <i class="fas fa-paste"></i>
              D√°n d√≤ng m√£ ƒë√£ m√£ h√≥a
            </label>
            <textarea 
              id="inheritance-encrypted-input" 
              placeholder="D√°n m√£ ƒë√£ m√£ h√≥a t·ª´ tab M√£ h√≥a..."
              class="input-field"
              rows="4"
            ></textarea>
          </div>

          <!-- Part 2: Inheritance Settings (hidden until valid input) -->
          <div id="inheritance-settings" class="inheritance-settings" style="display: none;">
            <h3 class="section-title">
              <i class="fas fa-cog"></i>
              C√†i ƒë·∫∑t th·ª´a k·∫ø
            </h3>

            <!-- Recipient Email -->
            <div class="input-section">
              <label class="input-label">
                <i class="fas fa-envelope"></i>
                Email ng∆∞·ªùi nh·∫≠n
              </label>
              <div class="asset-input-wrapper">
                <input 
                  type="email" 
                  id="recipient-email" 
                  placeholder="email@example.com"
                  class="input-field"
                >
                <div class="otp-inline">
                  <button class="info-btn" type="button" onclick="sendInlineOtp()">G·ª≠i OTP</button>
                </div>
              </div>
              <input 
                type="text" 
                id="recipient-otp" 
                placeholder="Nh·∫≠p OTP"
                class="input-field"
                style="margin-top: var(--spacing-2)"
              >
            </div>

            <!-- Security Message -->
            <div class="input-section">
              <label class="input-label">
                <i class="fas fa-comment"></i>
                L·ªùi nh·∫Øn (t√πy ch·ªçn)
              </label>
              <textarea 
                id="security-message" 
                placeholder="L·ªùi nh·∫Øn s·∫Ω ƒë∆∞·ª£c g·ª≠i c√πng email..."
                class="input-field"
                rows="3"
              ></textarea>
            </div>

            <!-- Security Question -->
            <div class="input-section">
              <label class="input-label">
                <i class="fas fa-question-circle"></i>
                C√¢u h·ªèi b·∫£o m·∫≠t
              </label>
              <input 
                type="text" 
                id="security-question" 
                placeholder="C√¢u h·ªèi ƒë·ªÉ x√°c th·ª±c ng∆∞·ªùi nh·∫≠n..."
                class="input-field"
              >
              <input 
                type="text" 
                id="security-answer" 
                placeholder="ƒê√°p √°n (s·∫Ω ƒë∆∞·ª£c m√£ h√≥a)"
                class="input-field"
              >
            </div>

            <!-- Inheritance Conditions -->
            <div class="inheritance-conditions">
              <h4 class="subsection-title">
                <i class="fas fa-clock"></i>
                ƒêi·ªÅu ki·ªán k√≠ch ho·∫°t th·ª´a k·∫ø
              </h4>
              
              <div class="condition-group">
                <label class="condition-label">
                  <i class="fas fa-calendar-alt"></i>
                  Th·ªùi gian
                </label>
                <input 
                  type="datetime-local" 
                  id="inheritance-time" 
                  class="input-field"
                >
              </div>

              <div class="condition-group">
                <label class="condition-label">
                  <i class="fas fa-chart-line"></i>
                  ƒêi·ªÅu ki·ªán gi√°
                </label>
                <div class="price-inputs">
                  <div class="price-input-group">
                    <label>Cao h∆°n</label>
                    <input 
                      type="number" 
                      id="inheritance-price-higher" 
                      placeholder="Gi√° cao h∆°n"
                      class="input-field"
                      step="0.000001"
                    >
                  </div>
                  <div class="price-input-group">
                    <label>Th·∫•p h∆°n</label>
                    <input 
                      type="number" 
                      id="inheritance-price-lower" 
                      placeholder="Gi√° th·∫•p h∆°n"
                      class="input-field"
                      step="0.000001"
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- Inheritance Actions -->
            <div class="inheritance-actions">
              <button class="primary-btn" onclick="setupInheritance()">
                <i class="fas fa-save"></i>
                L∆∞u & Kh√≥a th·ª´a k·∫ø
              </button>
              <button class="secondary-btn" onclick="cancelInheritance()">
                <i class="fas fa-times"></i>
                H·ªßy th·ª´a k·∫ø
              </button>
              <button class="info-btn" onclick="viewInheritanceStatus()">
                <i class="fas fa-info-circle"></i>
                Xem t√¨nh tr·∫°ng
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Decryption Tab -->
      <section id="decrypt-tab" class="tab-content">
        <div class="content-card">
          <div class="card-header">
            <h2><i class="fas fa-unlock"></i> Gi·∫£i m√£ d·ªØ li·ªáu</h2>
            <p class="card-subtitle">M·ªü kh√≥a th√¥ng tin khi ƒë·ªß ƒëi·ªÅu ki·ªán</p>
          </div>

          <!-- Encrypted Data Input -->
          <div class="input-section">
            <label class="input-label">
              <i class="fas fa-paste"></i>
              D√°n m√£ ƒë√£ m√£ h√≥a
            </label>
            <textarea 
              id="decrypt-input" 
              placeholder="D√°n m√£ ƒë√£ m√£ h√≥a..."
              class="input-field"
              rows="6"
            ></textarea>
          </div>

          <!-- Decrypt Button -->
          <button class="primary-btn decrypt-btn" onclick="decryptData()">
            <i class="fas fa-unlock"></i>
            Gi·∫£i m√£
          </button>

          <!-- Loading Indicator -->
          <div id="decrypt-loading" class="loading-section" style="display: none;">
            <div class="spinner"></div>
            <p>ƒêang ki·ªÉm tra ƒëi·ªÅu ki·ªán v√† gi·∫£i m√£...</p>
          </div>

          <!-- Decryption Result -->
          <div id="decrypt-result" class="result-section" style="display: none;">
            <div class="result-header">
              <h3 id="decrypt-result-title">
                <i class="fas fa-check-circle"></i>
                Gi·∫£i m√£ th√†nh c√¥ng
              </h3>
              <button class="copy-btn" onclick="copyDecryptedResult()">
                <i class="fas fa-copy"></i>
                Copy
              </button>
            </div>
            <div class="decrypted-content">
              <div id="decrypted-data" class="decrypted-data"></div>
            </div>
          </div>

          <!-- Condition Status -->
          <div id="condition-status" class="condition-status" style="display: none;">
            <div class="status-header">
              <h3><i class="fas fa-clock"></i> Tr·∫°ng th√°i ƒëi·ªÅu ki·ªán</h3>
            </div>
            <div class="status-content">
              <div id="time-status" class="status-item">
                <i class="fas fa-calendar-alt"></i>
                <span id="time-status-text"></span>
              </div>
              <div id="price-status" class="status-item">
                <i class="fas fa-chart-line"></i>
                <span id="price-status-text"></span>
              </div>
            </div>
            <div class="countdown-section">
              <div id="countdown-timer" class="countdown-timer"></div>
            </div>
            <button class="proof-btn" onclick="viewProof()">
              <i class="fas fa-eye"></i>
              Xem b·∫±ng ch·ª©ng
            </button>
          </div>

          <!-- Inheritance Actions (if applicable) -->
          <div id="inheritance-actions-decrypt" class="inheritance-actions-decrypt" style="display: none;">
            <button class="pulse-btn cancel-inheritance-btn" onclick="cancelInheritanceFromDecrypt()">
              <i class="fas fa-times"></i>
              H·ªßy th·ª´a k·∫ø
            </button>
            <button class="pulse-btn view-status-btn" onclick="viewInheritanceStatusFromDecrypt()">
              <i class="fas fa-info-circle"></i>
              Xem t√¨nh tr·∫°ng th·ª´a k·∫ø
            </button>
          </div>

          <!-- Technology Card -->
          <div class="tech-card">
            <h3 class="tech-title">
              <i class="fas fa-microchip"></i>
              C√¥ng ngh·ªá b·∫£o m·∫≠t
            </h3>
            <div class="tech-features">
              <div class="tech-feature">
                <i class="fas fa-clock"></i>
                <span>Th·ªùi gian phi t·∫≠p trung: drand</span>
              </div>
              <div class="tech-feature">
                <i class="fas fa-chart-line"></i>
                <span>Gi√° phi t·∫≠p trung: Pyth TWAP + confidence</span>
              </div>
              <div class="tech-feature">
                <i class="fas fa-shield-alt"></i>
                <span>Ch·ªëng l∆∞·ª£ng t·ª≠: AES-256 + ECDH + Kyber</span>
              </div>
              <div class="tech-feature">
                <i class="fas fa-signature"></i>
                <span>Ch·ªØ k√Ω: Dilithium/Falcon</span>
              </div>
              <div class="tech-feature">
                <i class="fas fa-laptop"></i>
                <span>Gi·∫£i m√£ client-side</span>
              </div>
            </div>
            <button class="proof-btn" onclick="viewProof()">
              <i class="fas fa-eye"></i>
              Xem b·∫±ng ch·ª©ng
            </button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Toast Notifications -->
  <div id="toast-container" class="toast-container"></div>

  <!-- Proof Modal -->
  <div id="proof-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-eye"></i> B·∫±ng ch·ª©ng x√°c th·ª±c</h3>
        <button class="modal-close" onclick="closeProofModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div id="proof-content"></div>
      </div>
    </div>
  </div>

  <!-- Security Question Modal -->
  <div id="security-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-question-circle"></i> X√°c th·ª±c b·∫£o m·∫≠t</h3>
        <button class="modal-close" onclick="closeSecurityModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="security-question-form">
          <label class="input-label">C√¢u h·ªèi b·∫£o m·∫≠t:</label>
          <p id="security-question-display" class="security-question"></p>
          <input 
            type="text" 
            id="security-answer-input" 
            placeholder="Nh·∫≠p ƒë√°p √°n..."
            class="input-field"
          >
          <button class="primary-btn" onclick="submitSecurityAnswer()">
            <i class="fas fa-check"></i>
            X√°c nh·∫≠n
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    function sendInlineOtp(){
      if(window.quantumVault){ window.quantumVault.sendInlineOtp(); }
    }
  </script>
</body>
</html>
